#!/bin/sh

# ==============================================================================
#
# run_project.sh
#
# Description:
#   이 스크립트는 이전 빌드를 정리, CMake를 사용하여 프로젝트를 구성,
#   정의된 모든 타겟(라이브러리, 실행파일, 테스트)을 빌드, CTest를 사용한 테스트 스위트 실행,
#   커스텀 도구 타겟 생성을 실행합니다.
#
# Usage:
#   ./run_project.sh ...
#
# ==============================================================================

# 1. 이전 빌드 아티팩트 제거 (선택 사항, 깨끗한 테스트를 위해)
rm -rf build/

# 2. 빌드 디렉토리를 만들고 그 안으로 이동
mkdir build && cd build

# 3. CMake를 사용하여 프로젝트 구성
# 이 단계는 CMakeLists.txt에 구문 오류가 있거나 모듈을 찾을 수 없는 경우 실패합니다.
cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=ON

# 4. 정의된 모든 타겟(라이브러리, 실행 파일, 테스트) 빌드
# 이 단계는 컴파일 또는 링크 오류가 있는 경우 실패합니다.
make -j $(nproc)

# 5. CTest를 사용하여 테스트 스위트 실행
# 이는 테스트 타겟이 생성되고 올바르게 링크되었는지 확인합니다.
ctest --verbose

# 6. 도구 타겟이 실행될 수 있는지 확인 (예: format)
# 이는 커스텀 도구 타겟이 생성되었는지 확인합니다.
make format
