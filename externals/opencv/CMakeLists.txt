# Fetch opencv_contrb first
include(FetchContent)
FetchContent_Declare(
    opencv_contrib
    GIT_REPOSITORY https://github.com/opencv/opencv_contrib.git
    GIT_TAG 4.5.5
    GIT_SHALLOW TRUE
)
FetchContent_MakeAvailable(opencv_contrib)

# Now fetch opencv, injecting contrib path
add_external_package(
    VERSION 4.5.5
    DESCRIPTION "Open Source Computer Vision Library"
    REPOSITORY_URL "https://github.com/opencv/opencv.git"
    REPOSITORY_TAG "4.5.5"
    INCLUDE_SUBDIR "opencv4"
    COMPILE_ARGUMENTS
        -D OPENCV_EXTRA_MODULES_PATH=${opencv_contrib_SOURCE_DIR}/modules
        -D CMAKE_BUILD_TYPE=RELEASE
        -D WITH_CUDA=true
        -D WITH_NVCUVID=true
        -D BUILD_opencv_cudaarithm=true
        -D BUILD_opencv_cudacodec=true
        -D BUILD_opencv_cudaimgproc=true
        -D BUILD_opencv_cudawarping=true
        -D OPENCV_GENERATE_SETUPVARS=false
        -D WITH_1394=false
        -D WITH_ADE=false
        -D WITH_ARAVIS=false
        -D WITH_ARITH_DEC=false
        -D WITH_ARITH_ENC=false
        -D WITH_CLP=false
        -D WITH_CUBLAS=false
        -D WITH_CUDNN=false
        -D WITH_CUFFT=false
        -D WITH_EIGEN=false
        -D WITH_FFMPEG=true
        -D WITH_GDAL=false
        -D WITH_GDCM=false
        -D WITH_GPHOTO2=false
        -D WITH_GSTREAMER=false
        -D WITH_GTK=true
        -D WITH_GTK_2_X=false
        -D WITH_HALIDE=false
        -D WITH_HPX=false
        -D WITH_IMGCODEC_HDR=false
        -D WITH_IMGCODEC_PFM=false
        -D WITH_IMGCODEC_PXM=false
        -D WITH_IMGCODEC_SUNRASTER=false
        -D WITH_INF_ENGINE=false
        -D WITH_IPP=false
        -D WITH_ITT=false
        -D WITH_JASPER=false
        -D WITH_JPEG=true
        -D WITH_JULIA=false
        -D WITH_LAPACK=false
        -D WITH_LIBREALSENSE=false
        -D WITH_MATLAB=false
        -D WITH_MFX=false
        -D WITH_NGRAPH=false
        -D WITH_NVCUVID=true
        -D WITH_OPENCL=false
        -D WITH_OPENCLAMDBLAS=false
        -D WITH_OPENCLAMDFFT=false
        -D WITH_OPENCL_SVM=false
        -D WITH_OPENEXR=false
        -D WITH_OPENGL=false
        -D WITH_OPENJPEG=false
        -D WITH_OPENMP=false
        -D WITH_OPENNI=false
        -D WITH_OPENNI2=false
        -D WITH_OPENVX=false
        -D WITH_PLAIDML=false
        -D WITH_PNG=true
        -D WITH_PROTOBUF=false
        -D WITH_PTHREADS_PF=false
        -D WITH_PVAPI=false
        -D WITH_QT=false
        -D WITH_QUIRC=false
        -D WITH_TBB=false
        -D WITH_TESSERACT=false
        -D WITH_TIFF=false
        -D WITH_V4L=false
        -D WITH_LIBV4L=false
        -D WITH_VA=false
        -D WITH_VA_INTEL=false
        -D WITH_VTK=false
        -D WITH_VULKAN=false
        -D WITH_WEBP=false
        -D WITH_XIMEA=false
        -D VIDEOIO_ENABLE_PLUGINS=true
        -D VIDEOIO_PLUGIN_LIST=ffmpeg
        -D VIDEOIO_ENABLE_STRICT_PLUGIN_CHECK=false
        -D BUILD_CUDA_STUBS=false
        -D BUILD_DOCS=false
        -D BUILD_EXAMPLES=false
        -D BUILD_IPP_IW=false
        -D BUILD_ITT=false
        -D BUILD_JASPER=false
        -D BUILD_JAVA=false
        -D BUILD_JPEG=false
        -D BUILD_OPENEXR=false
        -D BUILD_OPENJPEG=false
        -D BUILD_PACKAGE=false
        -D BUILD_PERF_TESTS=false
        -D BUILD_PNG=false
        -D BUILD_PROTOBUF=false
        -D BUILD_SHARED_LIBS=true
        -D BUILD_TBB=false
        -D BUILD_TESTS=false
        -D BUILD_TIFF=false
        -D BUILD_USE_SYMLINKS=false
        -D BUILD_WEBP=false
        -D BUILD_WITH_DEBUG_INFO=false
        -D BUILD_WITH_DYNAMIC_IPP=false
        -D BUILD_ZLIB=false
        -D BUILD_opencv_apps=false
        -D BUILD_opencv_aruco=false
        -D BUILD_opencv_bgsegm=false
        -D BUILD_opencv_bioinspired=false
        -D BUILD_opencv_calib3d=true
        -D BUILD_opencv_ccalib=false
        -D BUILD_opencv_core=true
        -D BUILD_opencv_cudev=true
        -D BUILD_opencv_cudaarithm=$BUILD_opencv_cudaarithm
        -D BUILD_opencv_cudabgsegm=false
        -D BUILD_opencv_cudacodec=$BUILD_opencv_cudacodec
        -D BUILD_opencv_cudafeatures2d=true
        -D BUILD_opencv_cudafilters=true
        -D BUILD_opencv_cudaimgproc=$BUILD_opencv_cudaimgproc
        -D BUILD_opencv_cudalegacy=false
        -D BUILD_opencv_cudaobjdetect=false
        -D BUILD_opencv_cudaoptflow=false
        -D BUILD_opencv_cudastereo=false
        -D BUILD_opencv_cudawarping=$BUILD_opencv_cudawarping
        -D BUILD_opencv_datasets=false
        -D BUILD_opencv_dnn=false
        -D BUILD_opencv_dnn_objdetect=false
        -D BUILD_opencv_dnn_superres=false
        -D BUILD_opencv_dpm=false
        -D BUILD_opencv_face=false
        -D BUILD_opencv_features2d=true
        -D BUILD_opencv_flann=true
        -D BUILD_opencv_freetype=false
        -D BUILD_opencv_fuzzy=false
        -D BUILD_opencv_gapi=false
        -D BUILD_opencv_hfs=false
        -D BUILD_opencv_highgui=true
        -D BUILD_opencv_img_hash=false
        -D BUILD_opencv_imgcodecs=true
        -D BUILD_opencv_imgproc=true
        -D BUILD_opencv_intensity_transform=false
        -D BUILD_opencv_java=false
        -D BUILD_opencv_java_bindings_generator=false
        -D BUILD_opencv_js=false
        -D BUILD_opencv_line_descriptor=false
        -D BUILD_opencv_mcc=false
        -D BUILD_opencv_ml=false
        -D BUILD_opencv_objdetect=false
        -D BUILD_opencv_optflow=false
        -D BUILD_opencv_phase_unwrapping=false
        -D BUILD_opencv_photo=false
        -D BUILD_opencv_plot=true
        -D BUILD_opencv_python_bindings_generator=false
        -D BUILD_opencv_python_tests=false
        -D BUILD_opencv_quality=false
        -D BUILD_opencv_rapid=false
        -D BUILD_opencv_reg=false
        -D BUILD_opencv_rgbd=false
        -D BUILD_opencv_saliency=false
        -D BUILD_opencv_shape=false
        -D BUILD_opencv_stereo=false
        -D BUILD_opencv_stitching=false
        -D BUILD_opencv_structured_light=false
        -D BUILD_opencv_superres=false
        -D BUILD_opencv_surface_matching=false
        -D BUILD_opencv_text=false
        -D BUILD_opencv_tracking=true
        -D BUILD_opencv_ts=false
        -D BUILD_opencv_video=true
        -D BUILD_opencv_videoio=true
        -D BUILD_opencv_videostab=false
        -D BUILD_opencv_world=true
        -D BUILD_opencv_xfeatures2d=false
        -D BUILD_opencv_ximgproc=false
        -D BUILD_opencv_xobjdetect=false
        -D BUILD_opencv_xphoto=false
        -DCMAKE_CUDA_ARCHITECTURES=75;80;86
        -DOpenCV_FORCE_3RDPARTY_BUILD=ON
        -DCUDA_ARCH_BIN="75 80 86"
        -DCUDA_ARCH_PTX=""
    LIBRARIES opencv_world
)
